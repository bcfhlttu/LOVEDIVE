<!DOCTYPE html>
<html lang = ko>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ë‘ ê°€ì¥ ë‹®ì€ IVE ë©¤ë²„ëŠ”?</title>
</head>
<body>
    <div>
        <h1>ì¸ë‹®</h1>
        <h3>ë‚˜ë‘ ê°€ì¥ ë‹®ì€ IVE ë©¤ë²„ëŠ”?</h3>
    </div>>
    
<div id = "upload-area">
    <span>ğŸ“·</span>
    <br />
    <span>ì‚¬ì§„ì„ ì—…ë¡œë“œ í•´ ì£¼ì„¸ìš”! ì–¼êµ´ ë¹„ì¤‘ì´ ë†’ì„ìˆ˜ë¡ ì •í™•ë„ëŠ” ì˜¬ë¼ê°‘ë‹ˆë‹¤!</span>
    <input id="upload-input" style="display: none;" type="file" accept="image/*" onchange="readFile(this.files[0]);" />
</div>
<div id="loading-area" style="display: none;">
    <span>ì¸ê³µì§€ëŠ¥ì´ ìˆ¨ì°¸ê³  LOVE DIVEì¤‘...</span>
</div>>
<div id="result-area" style="display: none;">
    <img id="upload-image" src="#" alt="your image" />
    <div id='label-container'></div>
</div>

<div id="retry-area" style="display: none;">
    <span>ë‹¤ë¥¸ ì‚¬ì§„ìœ¼ë¡œ í•œë²ˆë”??</span>>
</div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
<script type="text/javascript">
    const URL = "https://teachablemachine.withgoogle.com/models/cCsjWzuG6/";

    let model, labelContainer, maxPredictions;
    let isModelReady = false;
    let input = document.getElementById("upload-input");
    let image = document.getElementById("upload-image");
    let uploadArea = document.getElementById("upload-area");
    let loadingArea = document.getElementById("loading-area");
    let resultArea = document.getElementById("result-area");
    let retryArea = document.getElementById("retry-area");
    const reader = new FileReader();
    async function readFile(file) {
        uploadArea.style.display = "none";
        if (isModelReady === false) {
            loadingArea.style.display = "block";
            await init();
        }
        
        reader.readAsDataURL(file);
    }

    reader.onload = async function(event) {
        await image.setAttribute('src' , event.target.result);
        await predict();
        loadingArea.style.display = "none";
        resultArea.style.display = "block";
        retryArea.style.display = "block";
    };

    uploadArea.onclick =  function() {
        input.click();
    }

    uploadArea.ondragover = function(event) {
        event.preventDefault();
    }

    uploadArea.ondrop = function(event) {
        event.preventDefault();
        const file = event.dataTransfer.files[0];
        readFile(file);
    }

    retryArea.onclick = function() {
        retryArea.style.display = "none";
        resultArea.style.display = "none";
        uploadArea.style.display = "block";
        input.value = "";
    }

        async function init() {
        const modelURL = URL + "model.json";
        const metadataURL = URL + "metadata.json";

        
        model = await tmImage.load(modelURL, metadataURL);
        maxPredictions = model.getTotalClasses();
       
        labelContainer = document.getElementById("label-container");
        for (let i = 0; i < maxPredictions + 1; i++) { 
            labelContainer.appendChild(document.createElement("div"));
        }
    }

    
    async function predict() {
        
        const prediction = await model.predict(image);
        
        prediction.sort((x, y) => y.probability - x.probability);

        switch (prediction[0].className) {
            case "ë¦¬ì¦ˆ":
                labelContainer.childNodes[0].innerHTML = "<h3>ë‚˜ì™€ ë‹®ì€ IVE ë©¤ë²„ëŠ” ë¦¬ì¦ˆì…ë‹ˆë‹¤! ê¸ˆë°œì„ í•œë‹¤ê³  í•´ì„œ ë¦¬ì¦ˆê°€ ë” ì˜ ë‚˜ì˜¤ì§„ ì•Šì•„ìš”!</h3>";
                break;

            case "ì´ì„œ":
                labelContainer.childNodes[0].innerHTML = "<h3>ë‚˜ì™€ ë‹®ì€ IVE ë©¤ë²„ëŠ” ì´ì„œì…ë‹ˆë‹¤! ì–¼ë¹¡ìƒ·ì„ ì°ì–´ë„ ì´ì„œê°€ ë” ì˜ ë‚˜ì˜¤ì§„ ì•Šì•„ìš”!</h3>";
                break;

            case "ì›ì˜":
                labelContainer.childNodes[0].innerHTML = "<h3>ë‚˜ì™€ ë‹®ì€ IVE ë©¤ë²„ëŠ” ì›ì˜ì…ë‹ˆë‹¤! ì›ì˜ì´í•„í„°ë¥¼ ì“´ë‹¤ê³  ì›ì˜ì´ê°€ ë” ì˜ ë‚˜ì˜¤ì§„ ì•Šì•„ìš”!</h3>";
                break;
            
            case "ê°€ì„":
                labelContainer.childNodes[0].innerHTML = "<h3>ë‚˜ì™€ ë‹®ì€ IVE ë©¤ë²„ëŠ” ê°€ì„ì…ë‹ˆë‹¤! ì•„ëŠ” í›„ë°°ê°€ ë§ì•„ë„ ê°€ì„ì´ê°€ ë” ì˜ ë‚˜ì˜¤ì§„ ì•Šì•„ìš”!</h3>";
                break;

            case "ìœ ì§„":
                labelContainer.childNodes[0].innerHTML = "<h3>ë‚˜ì™€ ë‹®ì€ IVE ë©¤ë²„ëŠ” ìœ ì§„ì…ë‹ˆë‹¤! ê°•ì•„ì§€ ì‚¬ì§„ì„ ì°ì–´ë„ ìœ ì§„ì´ê°€ ë” ì˜ ë‚˜ì˜¤ì§„ ì•Šì•„ìš”!</h3>";
                break;

            case "ë ˆì´":
                labelContainer.childNodes[0].innerHTML = "<h3>ë‚˜ì™€ ë‹®ì€ IVE ë©¤ë²„ëŠ” ë ˆì´ì…ë‹ˆë‹¤! ê°¸ë£¨í”¼ìŠ¤ë¥¼ í•´ë´ë„ ë ˆì´ê°€ ë” ì˜ ë‚˜ì˜¤ì§„ ì•Šì•„ìš”!</h3>";
                break;

            default:
                labelContainer.childNodes[0].innerHTML = "<h3>ì˜¤ë¥˜ë°œìƒ</h3>";
                break;
        }

        for (let i = 0; i < maxPredictions; i++) {
            const classPrediction =
                prediction[i].className + ": " + Math.round(prediction[i].probability * 100) + "%";
            labelContainer.childNodes[i+1].innerHTML = classPrediction;
        }
        isModelReady = true;    
    }
</script>

    

</body>
</html>